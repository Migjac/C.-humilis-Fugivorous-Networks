---
title: "Untitled"
author: "Miguel Jacome"
date: "22/1/2018"
output: html_document
---
```{r Visits}
fenol_visits<-read.csv("~/Desktop/Palmito/Postdoc-Interaction Networks/C.-humilis-Fugivorous-Networks/Interaction Motifs/im_visits_fenol.csv")
fv<-subset(fenol_visits[2:7])

#convert data.frame to matrix
fv<-data.matrix(fv)

#mean and sum for each row (1)
fv_mean<-apply(fv,1,mean)
fv_sum<-apply(fv,1,sum)


#Creating long shape with the means of each plant
fv_long<-melt(fv_mean,id.vars="mean")
colnames(fv_long) <- "mean_visits"
fv_long_sum<-melt(fv_sum,id.vars="sum")
colnames(fv_long_sum) <- "sum_visits"


#Adding new columns of visits summaries 
fenol_visits["mean_visits"]<-NA
fenol_visits$mean_visits<-fv_long$mean_visits

fenol_visits["sum_visits"]<-NA
fenol_visits$sum_visits<-fv_long_sum$sum_visits



#GLMM visits
fv_glmm<-glm(mean_visits~inf_s+size_s+sincr_s+fruits_s+fruit_set_s+del.area_s+nn_s+dens_s,data = fenol_visits)
fv_glmm
summary(fv_glmm)
anova(fv_glmm, test="Chisq")

fv_glmm2<-lmer(sum_visits~inf_s+size_s+fruits_s+fruit_set_s+del.area_s+nn_s+dens_s+(1 | pop),data = fenol_visits)
fv_glmm2
summary(fv_glmm2)
Anova(fv_glmm2, type="III")

fv_glmm3<-lmer(motif~inf_s+size_s+fruits_s+fruit_set_s+del.area_s+nn_s+dens_s+(1 | pop), family=binomial, data = fenol_visits)
fv_glmm3
summary(fv_glmm3)
Anova(fv_glmm3, type="III")

```

```{r Handled fruits}
fenol_fruits<-read.csv("~/Desktop/Palmito/Postdoc-Interaction Networks/C.-humilis-Fugivorous-Networks/Interaction Motifs/im_fruits_fenol.csv")
ff<-subset(fenol_fruits[2:7])

#convert data.frame to matrix
ff<-data.matrix(ff)

#mean and sum for each row (1)
ff_mean<-apply(ff,1,mean)
ff_sum<-apply(ff,1,sum)


#Creating long shape with the means of each plant
ff_long<-melt(ff_mean,id.vars="mean")
colnames(ff_long) <- "mean_fruits"
ff_long_sum<-melt(ff_sum,id.vars="sum")
colnames(ff_long_sum) <- "sum_fruits"


#Adding new columns of visits summaries 
fenol_fruits["mean_fruits"]<-NA
fenol_fruits$mean_fruits<-ff_long$mean_fruits

fenol_fruits["sum_fruits"]<-NA
fenol_fruits$sum_fruits<-ff_long_sum$sum_fruits



#GLMM visits
ff_glmm<-glm(mean_fruits~inf_s+size_s+sincr_s+fruits_s+fruit_set_s+del.area_s+nn_s+dens_s,data = fenol_fruits)
ff_glmm
summary(ff_glmm)
anova(ff_glmm, test="Chisq")

ff_glmm2<-lmer(sum_fruits~inf_s+size_s+fruits_s+fruit_set_s+del.area_s+nn_s+dens_s+(1 | pop),data = fenol_fruits)
ff_glmm2
summary(ff_glmm2)
anova(ff_glmm2, test="Chisq")
Anova(ff_glmm2, type="III")

ff_glmm3<-glm(sum_fruits~inf_s+size_s+fruits_s+fruit_set_s+del.area_s+nn_s+dens_s+pop,data = fenol_fruits)
ff_glmm3
summary(ff_glmm3)
anova(ff_glmm3, test="Chisq")
Anova(ff_glmm3, type="III")

m<-glm(fenol_fruits$sum_fruits~motif, data= fenol_fruits)
summary(m)

m1<-glm(sum_visits~motif, data=fenol_visits)
summary(m1)
```


```{r Efficiency}
mart_matas_e<-read.csv("~/Desktop/Palmito/Postdoc-Interaction Networks/C.-humilis-Fugivorous-Networks/Interaction Motifs/im_glm_4.csv")

#Multiplying by the probability of recruitment
rabbit_weight=0.286
rat_weight=0.286
fox_weight=0.179
badger_weight=0.179
deer_weight=0.0115
wildb_weight=0
deer_weight=0.0112

mart_matas_e <-mutate(mart_matas_e,
    #Resize effects
    rabbit = rabbit * rabbit_weight,
    rat = rat * rat_weight,
    fox = fox * fox_weight,
    badger = badger * badger_weight,
    wildboar= wildboar * wildb_weight,
    deer=deer*deer_weight)

#subset only animal interactions
fe<-subset(mart_matas_e[2:7])

#convert data.frame to matrix
fe<-data.matrix(fe)

#mean and sum for each row (1)
fe_mean<-apply(fe,1,mean)
fe_sum<-apply(fe,1,sum)


#Creating long shape with the means of each plant
fe_long<-melt(fe_mean,id.vars="mean")
colnames(fe_long) <- "mean_eff"
fe_long_sum<-melt(fe_sum,id.vars="sum")
colnames(fe_long_sum) <- "sum_eff"


#Adding new columns of visits summaries 
mart_matas_e["mean_eff"]<-NA
mart_matas_e$mean_eff<-fe_long$mean_eff

mart_matas_e["sum_eff"]<-NA
mart_matas_e$sum_eff<-fe_long_sum$sum_eff


#####GLMM efficiency*recruitment####

#Mean recruitment by standardized traits and normalized degree
fe_glm<-glm(mean_eff~inf_s+norm_d+spp_str+size_s+sincr_s+fruits_s+fruit_set_s+del.area_s+nn_s+dens_s,data = mart_matas_e)
fe_glm
summary(fe_glm)
anova(fe_glm, test="Chisq")
lsmeans(fe_glm,"motif",transform="response")
summary(glht(fe_glm, mcp(motif="Tukey")))

#Mean recruitment by motif and standardized traits and normalized degree
fe_glm1<-glm(mean_eff~inf_s+motif+norm_d+size_s+sincr_s+fruits_s+fruit_set_s+del.area_s+nn_s+dens_s,data = mart_matas_e)
fe_glm1
summary(fe_glm1)
anova(fe_glm1, test="Chisq")
lsmeans(fe_glm1,"motif",transform="response")
summary(glht(fe_glm1, mcp(motif="Tukey")))

#Mean recruitment and standardized traits with population as random
library(nlme)
fe_glmm2<-lme(mean_eff~inf_s+size_s+fruits_s+fruit_set_s+del.area_s+nn_s+dens_s, random=~1| pop,data = mart_matas_e)
fe_glmm2
summary(fe_glmm2)
anova(fe_glmm2, test="Chisq")
lsmeans(fe_glmm2,"motif",transform="response")

#Mean recruitment by motif and standardized traits with population as random
fe_glmm3<-lme(mean_eff~inf_s+motif+norm_d+spp_str+size_s+fruits_s+fruit_set_s+del.area_s+nn_s+dens_s, random=~1| pop,data = mart_matas_e)
fe_glmm3
summary(fe_glmm3)
anova(fe_glmm3, test="Chisq")
lsmeans(fe_glmm3,"motif",transform="response")
summary(glht(fe_glmm3, mcp(motif="Tukey")))




#GLMM with network indexes

net_glmm1<-lme(norm_d~inf_s+size_s+fruits_s+fruit_set_s+del.area_s+nn_s+dens_s,random=~1| pop, data = mart_matas_e)
net_glmm1
summary(net_glmm1)
anova(net_glmm1, test="Chisq")
anova(net_glmm1, type="III")
lsmeans(net_glmm1,"motif",transform="response")

net_glmm2<-lme(spp_str~inf_s+size_s+fruits_s+fruit_set_s+del.area_s+nn_s+dens_s,random=~1| pop,data = mart_matas_e)
net_glmm2
summary(net_glmm2)
anova(net_glmm2, test="Chisq")
anova(net_glmm2, type="III")
lsmeans(net_glmm2,"motif",transform="response")

#With motifs
net_glmm3<-lme(norm_d~inf_s+size_s+motif+fruits_s+fruit_set_s+del.area_s+nn_s+dens_s,random=~1| pop,data = mart_matas_e)
net_glmm3
summary(net_glmm3)
anova(net_glmm3, test="Chisq")
anova(net_glmm3, type="III")
lsmeans(net_glmm3,"motif",transform="response")
summary(glht(net_glmm3, mcp(motif="Tukey")))


net_glmm4<-lme(spp_str~inf_s+size_s+motif+fruits_s+fruit_set_s+del.area_s+nn_s+dens_s,random=~1| pop,data = mart_matas_e)
net_glmm4
summary(net_glmm4)
anova(net_glmm4, test="Chisq")
anova(net_glmm4, type="III")
lsmeans(net_glmm4,"motif",transform="response")




#Standardized explanatory variables
f_glmm<-glm(mean_eff~inf+motif+size+sincr+fruits+fruit_set+del.area+nn+dens,data = mart_matas_e)
f_glmm
summary(f_glmm)
anova(f_glmm, test="Chisq")
lsmeans(f_glmm,"motif",transform="response")
plot(f_glmm)


f_glmm1<-standardize(mean_eff~inf+motif+size+sincr+fruits+fruit_set+del.area+nn+dens,data = mart_matas_e)
f_glmm1
f_glmm1$call
f_glmm1$scale
f_glmm1$family
f_glmm1$data
f_glmm1$contrasts
f_glmm1$groups
stnd_fe<-f_glmm1$data

write.csv(stnd_fe,"/Users/apple/desktop/Palmito/Postdoc-Interaction Networks/C.-humilis-Fugivorous-Networks/Interaction Motifs/Ant_Mutual_deer/stnd_var.csv")



```